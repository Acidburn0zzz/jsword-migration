<project name="jsword-web" default="all">

  <import file="../common/core.xml"/>
  <property name="dependency"       value="bibledesktop"/>
  <property name="dependency.jar"   value="../${dependency}/target/ant/jar"/>
  <property name="dependency.install" value="../${dependency}/target/ant/${dependency}"/>
  <property name="jnlp.web.hostname" value="http://www.crosswire.org"/>
  <property name="jnlp.web.location" value="jnlp"/>

  <!--=======================================================================-->
  <property name="source.web"       value="${source.root}/web"/>

  <property name="webapp.bibledesktop" value="${target.root}/web"/> <!-- override -->
  <property name="jnlp.hostname"    value="localhost:8080"/> <!-- override -->
  <property name="ftp.base"         value="${basedir}/${target.root}/download"/> <!-- override -->
  <property name="web.prefix"       value="../download"/> <!-- override -->

  <property name="nightly.dir"      value="${ftp.base}/nightly"/>
  <property name="release.dir"      value="${ftp.base}/release"/>
  <property name="target.installed" value="${webapp.jsword}/jnlp"/>

  <!--=======================================================================-->
  <target name="webapp" description="Build an unpacked war file">
    <mkdir dir="${webapp.bibledesktop}"/>
    <style basedir="${source.web}" extension=".html" style="${source.web}/template.xsl" destdir="${webapp.bibledesktop}">
      <include name="**/*.html"/>
      <xmlcatalog>
        <dtd publicid="-//W3C//DTD XHTML 1.0 Transitional//EN" location="${source.etc}/xhtml1-transitional.dtd"/>
      </xmlcatalog>
    </style>
    <copy todir="${webapp.bibledesktop}" filtering="true">
      <fileset dir="${source.web}">
        <include name="**/*.jnlp"/>
      </fileset>
      <filterset>
        <filter token="jnlp.hostname" value="${jnlp.hostname}"/>
      </filterset>
    </copy>
    <copy todir="${webapp.bibledesktop}">
      <fileset dir="${source.web}">
        <exclude name="*.jsp"/>
        <exclude name="*.html"/>
        <exclude name="*.xsl"/>
        <exclude name="**/*.jnlp"/>
      </fileset>
    </copy>
    <mkdir dir="${webapp.bibledesktop}/WEB-INF/classes"/>
    <mkdir dir="${webapp.bibledesktop}/WEB-INF/lib"/>
  </target>

  <!--=======================================================================-->
  <target name="install" depends="install.dependency, webapp" description="Install all the files" >
  </target>

  <!--=======================================================================-->
  <target name="incremental" depends="install" description="To be run nightly at crosswire">
    <!-- also used to depend on veryclean -->
  </target>

</project>
