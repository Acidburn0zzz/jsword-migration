<project name="bibledesktop" default="all">

  <!-- This build uses the core build targets -->
  <import file="../common/core.xml"/>

  <!--=======================================================================-->
  <property name="gener.root"       value="target/gener"/>
  <property name="target.jnlp"      value="${target.root}/bibledesktop"/>
  <property name="target.installed" value="${target.root}/installed"/>
  <property name="dependency"       value="jsword"/>
  <property name="dependency.jar"   value="../${dependency}/target/ant/jar"/>
	
  <!--=======================================================================-->
  <target name="testcompile.extra">
    <mkdir dir="${gener.root}/config"/>
    <style
        in="${source.res}/config.xml"
        out="${gener.root}/config/ConfigTest.java"
        style="${output.common}/config-test.xsl"/>
    <javac debug="on" includes="**/*.java" destdir="${test.classes}">
      <src path="${gener.root}/config"/>
      <classpath refid="test.jarpath"/>
    </javac>
  </target>

  <!--=======================================================================-->
  <target name="prepare.extra">
    <copy file="${source.etc}/jnlp/${ant.project.name}.jnlp"
    	  todir="${target.jnlp}"/>
    <copy todir="${target.jnlp}">
      <fileset dir="${source.etc}/bin"/>
    </copy>
    <chmod perm="a+x">
      <fileset dir="${target.jnlp}">
        <include name="**/*.sh"/>
      </fileset>
    </chmod>
    <fixcrlf srcdir="${target.jnlp}" eol="lf">
      <include name="**/*.sh"/>
    </fixcrlf>
    <fixcrlf srcdir="${target.jnlp}" eol="crlf">
      <include name="**/*.bat"/>
    </fixcrlf>
  </target>

  <!--=======================================================================-->
  <target name="jar.extra"
  	      description="Moves files to correct location for JNLP deploy" >
    <mkdir dir="${target.jnlp}"/>
  	<copy todir="${target.jnlp}">
  		<fileset dir="${target.jar}"/>
    </copy>
  </target>


  <!--=======================================================================-->
  <target name="install"
  	      depends="jar"
  	      description="Moves files to correct location for JNLP deploy" >
    <mkdir dir="${target.installed}"/>
    <copy todir="${target.installed}" filtering="true">
      <fileset dir="${target.jnlp}">
        <include name="**/*.jnlp"/>
      </fileset>
      <filterset>
        <filter token="HOSTNAME" value="${jnlp.hostname}"/>
        <filter token="WEBAPP" value="${ant.project.name}"/>
      </filterset>
    </copy>
    <copy todir="${target.installed}" filtering="false">
      <fileset dir="${target.jnlp}">
        <exclude name="**/*.jnlp"/>
      </fileset>
    </copy>
  </target>

  <!--=======================================================================-->
  <target name="exec" depends="jar" description="Run the project using Ant">
    <!--
      == org.crosswire.jsword.bibledesktop.Desktop
      == org.crosswire.jsword.book.ReadEverything
      == abbot.editor.Costello
      == org.acm.seguin.tools.install.PrettyPrinterConfigGUI
      -->
  	<java classname="org.crosswire.bibledesktop.desktop.Desktop" fork="true">
      <assertions enablesystemassertions="true">
        <enable/>
      </assertions>
      <jvmarg value="-Xmx512m"/>
      <classpath refid="runtime.jarpath"/>
    </java>
  </target>

  <!--=======================================================================-->
  <target name="cvsup.extra" description="Extra stuff to do after calling cvsup">
    <chmod perm="755">
      <fileset dir="${source.etc}/build" includes="**/*.sh"/>
    </chmod>
  </target>

</project>
